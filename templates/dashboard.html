<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Interview Connect</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0066CC 0%, #004A99 100%);
            min-height: 100vh;
            display: flex;
        }
        .app-container { display: flex; width: 100%; height: 100vh; }
        
        /* Sidebar - Matching Application/Job Board Assistant */
        .sidebar {
            width: 280px; 
            background: white; 
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            display: flex; 
            flex-direction: column; 
            z-index: 1000;
        }
        .sidebar-header {
            padding: 30px 25px; 
            border-bottom: 1px solid #e1e5e9;
            background: linear-gradient(135deg, #0066CC 0%, #004A99 100%); 
            color: white;
        }
        .logo-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        .logo-container svg {
            width: 120px;
            height: 50px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
        }
        .sidebar-header h2 { 
            font-size: 1.3rem; 
            font-weight: 600; 
            margin-bottom: 5px; 
        }
        .sidebar-header p { 
            font-size: 0.9rem; 
            opacity: 0.9; 
        }
        .tier-badge {
            display: inline-block; 
            padding: 4px 8px; 
            border-radius: 12px;
            font-size: 0.8rem; 
            font-weight: 600; 
            margin-top: 5px;
            background: rgba(255,255,255,0.2); 
            color: white;
        }
        .sidebar-nav { 
            flex: 1; 
            padding: 20px 0; 
        }
        .nav-item {
            display: block; 
            padding: 15px 25px; 
            color: #666; 
            text-decoration: none;
            font-weight: 500; 
            transition: all 0.3s ease; 
            border-left: 3px solid transparent;
        }
        .nav-item:hover { 
            background: #E6F2FF; 
            color: #0066CC; 
            border-left-color: #0066CC; 
        }
        .nav-item.active { 
            background: #E6F2FF; 
            color: #0066CC; 
            border-left-color: #0066CC; 
            font-weight: 600; 
        }
        
        /* Main Content - Matching style */
        .main-content { 
            flex: 1; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden; 
        }
        .top-bar {
            background: white; 
            padding: 15px 30px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex; 
            justify-content: space-between; 
            align-items: center;
        }
        .page-title { 
            font-size: 1.5rem; 
            font-weight: 600; 
            color: #333; 
        }
        .top-bar-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .logout-btn {
            background: linear-gradient(135deg, #0066CC 0%, #004A99 100%);
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 8px;
            font-weight: 500; 
            cursor: pointer; 
            transition: all 0.3s ease;
        }
        .logout-btn:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 5px 15px rgba(0, 102, 204, 0.4);
            background: linear-gradient(135deg, #0052A3 0%, #003D80 100%);
        }
        
        /* Content Area - Matching style */
        .content-area { 
            flex: 1; 
            padding: 30px; 
            overflow-y: auto; 
            background: #fafbfc; 
        }
        .content-wrapper {
            max-width: 1200px; 
            margin: 0 auto;
        }
        
        /* Dashboard specific styles - Updated to match */
        .dashboard-header {
            text-align: center;
            margin-bottom: 40px;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .dashboard-header h1 {
            font-size: 2rem;
            color: #333;
            margin-bottom: 10px;
            font-weight: 600;
        }
        .dashboard-header p {
            color: #666;
            font-size: 1.1rem;
        }
        
        /* Stats Grid - Updated styling */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 2px solid transparent;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border-color: #0066CC;
        }
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(135deg, #0066CC 0%, #004A99 100%);
        }
        .stat-label {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 500;
        }
        .stat-value {
            font-size: 36px;
            font-weight: bold;
            color: #0066CC;
            margin-bottom: 10px;
            transition: all 0.5s ease;
        }
        .stat-value.updating {
            transform: scale(1.1);
            color: #004A99;
        }
        .stat-change {
            font-size: 12px;
            color: #28a745;
            font-weight: 500;
        }
        .stat-change.negative {
            color: #dc3545;
        }
        
        /* Chart Section - Updated */
        .chart-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #0066CC;
        }
        .chart-title {
            font-size: 1.3rem;
            color: #333;
            font-weight: 600;
        }
        .chart-controls {
            display: flex;
            gap: 10px;
        }
        .chart-btn {
            padding: 8px 16px;
            background: white;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            color: #666;
        }
        .chart-btn:hover {
            border-color: #0066CC;
            color: #0066CC;
            background: #E6F2FF;
        }
        .chart-btn.active {
            background: linear-gradient(135deg, #0066CC 0%, #004A99 100%);
            color: white;
            border-color: #0066CC;
        }
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        
        /* Profile Section - Updated */
        .profile-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        .profile-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #0066CC;
        }
        .profile-title {
            font-size: 1.3rem;
            color: #333;
            font-weight: 600;
        }
        .profile-percentage {
            font-size: 24px;
            font-weight: bold;
            color: #0066CC;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #E6F2FF;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
            border: 2px solid #0066CC;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #0066CC 0%, #004A99 100%);
            transition: width 1s ease;
        }
        .profile-tasks {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .task-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #fafbfc;
            border-radius: 8px;
            border: 2px solid #e1e5e9;
            transition: all 0.3s ease;
        }
        .task-item:hover {
            border-color: #0066CC;
            background: #E6F2FF;
        }
        .task-check {
            width: 24px;
            height: 24px;
            border: 2px solid #e1e5e9;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            font-size: 14px;
        }
        .task-check.completed {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            border-color: #28a745;
            color: white;
        }
        
        /* News Section - Updated */
        .news-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        .news-header {
            font-size: 1.3rem;
            color: #333;
            font-weight: 600;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #0066CC;
        }
        .news-container {
            display: flex;
            gap: 20px;
            overflow-x: auto;
            padding-bottom: 10px;
        }
        .news-container::-webkit-scrollbar {
            height: 8px;
        }
        .news-container::-webkit-scrollbar-track {
            background: #E6F2FF;
            border-radius: 4px;
        }
        .news-container::-webkit-scrollbar-thumb {
            background: #0066CC;
            border-radius: 4px;
        }
        .news-item {
            min-width: 300px;
            padding: 20px;
            background: #fafbfc;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .news-item:hover {
            border-color: #0066CC;
            background: #E6F2FF;
            transform: translateY(-2px);
        }
        .news-category {
            font-size: 12px;
            color: #0066CC;
            text-transform: uppercase;
            margin-bottom: 8px;
            font-weight: 600;
        }
        .news-title {
            font-size: 15px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }
        .news-time {
            font-size: 12px;
            color: #999;
        }
        
        /* Live indicator - Updated */
        .live-indicator {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        .live-dot {
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
            animation: blink 1s infinite;
        }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        @media (max-width: 768px) {
            .app-container { flex-direction: column; }
            .sidebar { width: 100%; order: 2; }
            .main-content { order: 1; }
            .stats-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="logo-container">
                    <!-- InCo Logo -->
                    <svg viewBox="0 0 200 80" xmlns="http://www.w3.org/2000/svg">
                        <text x="10" y="60" style="font-family: Arial, sans-serif; font-size: 60px; font-weight: bold; fill: white;">
                            In<tspan style="fill: white;">Co</tspan>
                        </text>
                    </svg>
                </div>
                <h2>Welcome, {{ user_email.split('@')[0].title() }}</h2>
                <p>{{ user_email }}</p>
                <div class="tier-badge">{{ user_tier.title() }} - {{ resume_limit }} Resume{{ 's' if resume_limit > 1 else '' }}</div>
            </div>
            <nav class="sidebar-nav">
                 <a href="/dashboard" class="nav-item active">Dashboard</a>
                <a href="/application-assistant" class="nav-item">Application Assistant</a>
                <a href="/job-board-assistant" class="nav-item">Job Board Assistant</a>
                <a href="/resume-assistant" class="nav-item">Resume Assistant Coming Soon!</a>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="top-bar">
                <h1 class="page-title">Dashboard</h1>
                <div class="top-bar-right">
                    <button class="logout-btn" onclick="logout()">Logout</button>
                </div>
            </div>

            <div class="content-area">
                <div class="content-wrapper">
                    <!-- Dashboard Header -->
                    <div class="dashboard-header">
                        <h1>Interview Connect Dashboard</h1>
                        <p>Monitor your application progress and platform activity</p>
                    </div>

                    <!-- Stats Cards -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">Applications Today</div>
                            <div class="stat-value" id="todayCount">0</div>
                            <div class="stat-change" id="todayChange">+0% from yesterday</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Applications This Week</div>
                            <div class="stat-value" id="weekCount">0</div>
                            <div class="stat-change" id="weekChange">+0% from last week</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Applications This Month</div>
                            <div class="stat-value" id="monthCount">0</div>
                            <div class="stat-change" id="monthChange">+0% from last month</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Success Rate</div>
                            <div class="stat-value" id="successRate">0%</div>
                            <div class="stat-change">Based on submissions</div>
                        </div>
                    </div>

                    <!-- Chart Section -->
                    <div class="chart-section">
                        <div class="chart-header">
                            <h3 class="chart-title">Application Trends</h3>
                            <div class="chart-controls">
                                <button class="chart-btn active" onclick="updateChart('7d')">7 Days</button>
                                <button class="chart-btn" onclick="updateChart('30d')">30 Days</button>
                                <button class="chart-btn" onclick="updateChart('90d')">90 Days</button>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="trendsChart"></canvas>
                        </div>
                    </div>

                    <!-- Profile Completion -->
                    <div class="profile-section">
                        <div class="profile-header">
                            <h3 class="profile-title">Profile Completion</h3>
                            <div class="profile-percentage">60%</div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 60%"></div>
                        </div>
                        <div class="profile-tasks">
                            <div class="task-item">
                                <div class="task-check completed">✓</div>
                                <span>Basic Information</span>
                            </div>
                            <div class="task-item">
                                <div class="task-check completed">✓</div>
                                <span>Email Verified</span>
                            </div>
                            <div class="task-item">
                                <div class="task-check"></div>
                                <span>Upload Resume</span>
                            </div>
                            <div class="task-item">
                                <div class="task-check"></div>
                                <span>Add Profile Photo</span>
                            </div>
                            <div class="task-item">
                                <div class="task-check"></div>
                                <span>Complete Skills Section</span>
                            </div>
                        </div>
                    </div>

                    <!-- News Section -->
                    <div class="news-section">
                        <h3 class="news-header">Latest Updates & News</h3>
                        <div class="news-container">
                            <div class="news-item">
                                <div class="news-category">Interview Connect</div>
                                <div class="news-title">New AI-Powered Resume Optimization Feature Released</div>
                                <div class="news-time">2 hours ago</div>
                            </div>
                            <div class="news-item">
                                <div class="news-category">Job Market</div>
                                <div class="news-title">Tech Hiring Surge: 15% Increase in Software Engineering Roles</div>
                                <div class="news-time">5 hours ago</div>
                            </div>
                            <div class="news-item">
                                <div class="news-category">Tips</div>
                                <div class="news-title">5 Keywords That Get Your Resume Past ATS Systems</div>
                                <div class="news-time">1 day ago</div>
                            </div>
                            <div class="news-item">
                                <div class="news-category">Interview Connect</div>
                                <div class="news-title">LinkedIn Integration Now Available for Premium Users</div>
                                <div class="news-time">2 days ago</div>
                            </div>
                            <div class="news-item">
                                <div class="news-category">Industry News</div>
                                <div class="news-title">Remote Work Positions Up 40% Year-Over-Year</div>
                                <div class="news-time">3 days ago</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Chart
        let trendsChart;
        
        function initChart() {
            const ctx = document.getElementById('trendsChart').getContext('2d');
            trendsChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Applications Submitted',
                        data: [12, 19, 15, 25, 22, 30, 28],
                        borderColor: '#0066CC',
                        backgroundColor: 'rgba(0, 102, 204, 0.1)',
                        tension: 0.4,
                        fill: true,
                        borderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 102, 204, 0.1)'
                            },
                            ticks: {
                                color: '#666'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#666'
                            }
                        }
                    }
                }
            });
        }

        // Update stats from API
        async function updateStats() {
            try {
                const response = await fetch('/api/application-stats');
                const data = await response.json();
                
                // Update counters with animation
                animateValue('todayCount', data.today || 0);
                animateValue('weekCount', data.week || 0);
                animateValue('monthCount', data.month || 0);
                
                // Calculate success rate
                const successRate = data.successRate || 95;
                animateValue('successRate', successRate, '%');
                
                // Update changes
                document.getElementById('todayChange').textContent = `+${data.todayChange || 0}% from yesterday`;
                document.getElementById('weekChange').textContent = `+${data.weekChange || 0}% from last week`;
                document.getElementById('monthChange').textContent = `+${data.monthChange || 0}% from last month`;
                
                // Update chart if data available
                if (data.chartData) {
                    trendsChart.data.labels = data.chartData.labels;
                    trendsChart.data.datasets[0].data = data.chartData.values;
                    trendsChart.update();
                }
            } catch (error) {
                console.error('Error fetching stats:', error);
                // Use demo data if API not available
                animateValue('todayCount', 12);
                animateValue('weekCount', 47);
                animateValue('monthCount', 183);
                animateValue('successRate', 95, '%');
            }
        }

        // Animate number changes
        function animateValue(id, end, suffix = '') {
            const element = document.getElementById(id);
            const start = parseInt(element.textContent) || 0;
            const duration = 500;
            const startTime = performance.now();
            
            element.classList.add('updating');
            
            function update(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const current = Math.floor(start + (end - start) * progress);
                element.textContent = current + suffix;
                
                if (progress < 1) {
                    requestAnimationFrame(update);
                } else {
                    element.classList.remove('updating');
                }
            }
            
            requestAnimationFrame(update);
        }

        // Update chart view
        function updateChart(period) {
            // Update button states
            document.querySelectorAll('.chart-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update chart data based on period
            // This would fetch from API in production
            console.log('Updating chart for period:', period);
        }

        // Load user info
        function loadUserInfo() {
            const userSession = JSON.parse(sessionStorage.getItem('userSession') || '{}');
            if (userSession.user) {
                document.getElementById('userName').textContent = userSession.user.name || 'User';
                document.getElementById('userEmail').textContent = userSession.user.email || '';
                document.getElementById('userTier').textContent = 
                    `${userSession.user.tier || 'Basic'} - ${userSession.user.resume_limit || 1} Resume${userSession.user.resume_limit > 1 ? 's' : ''}`;
            }
        }

        // Logout function
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                sessionStorage.clear();
                window.location.href = '/logout';
            }
        }

        // WebSocket for real-time updates (optional enhancement)
        function connectWebSocket() {
            const ws = new WebSocket('ws://localhost:5000/ws');
            
            ws.onmessage = function(event) {
                const data = JSON.parse(event.data);
                if (data.type === 'application_submitted') {
                    // Flash the today counter
                    const todayElement = document.getElementById('todayCount');
                    todayElement.style.color = '#28a745';
                    setTimeout(() => {
                        todayElement.style.color = '#0066CC';
                    }, 1000);
                    
                    // Update stats
                    updateStats();
                }
            };
        }
    </script>
</body>
</html>